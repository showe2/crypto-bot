<div class="bg-white rounded-xl shadow-lg p-6">
  <div class="flex items-center justify-between mb-4">
    <h3 class="text-lg font-semibold text-gray-900">System Health</h3>
    <div class="flex items-center space-x-2">
      <div
        class="w-3 h-3 rounded-full"
        :class="{
                     'status-healthy': systemHealth && systemHealth.overall_status,
                     'status-unhealthy': systemHealth && !systemHealth.overall_status,
                     'status-warning': !systemHealth
                 }"
      ></div>
      <span class="text-sm font-medium text-gray-700">
        <span x-show="systemHealth && systemHealth.overall_status"
          >All Systems Operational</span
        >
        <span x-show="systemHealth && !systemHealth.overall_status"
          >Issues Detected</span
        >
        <span x-show="!systemHealth">Checking Status...</span>
      </span>
    </div>
  </div>

  <!-- Service Status Grid -->
  <div class="space-y-3" x-show="systemHealth">
    <template x-if="systemHealth && systemHealth.services">
      <template x-for="(service, name) in systemHealth.services" :key="name">
        <div
          class="flex items-center justify-between p-3 bg-gray-50 rounded-lg"
        >
          <div class="flex items-center space-x-3">
            <div
              class="w-2 h-2 rounded-full"
              :class="{
                                 'bg-green-500': service.healthy,
                                 'bg-red-500': !service.healthy && service.healthy !== undefined,
                                 'bg-yellow-500': service.healthy === undefined
                             }"
            ></div>
            <div>
              <p
                class="text-sm font-medium text-gray-900 capitalize"
                x-text="name.replace('_', ' ')"
              ></p>
              <p
                class="text-xs text-gray-500"
                x-show="service.version"
                x-text="'v' + service.version"
              ></p>
            </div>
          </div>
          <div class="text-right">
            <span
              class="text-xs px-2 py-1 rounded-full"
              :class="{
                                  'bg-green-100 text-green-800': service.healthy,
                                  'bg-red-100 text-red-800': !service.healthy && service.healthy !== undefined,
                                  'bg-yellow-100 text-yellow-800': service.healthy === undefined
                              }"
            >
              <span x-show="service.healthy">Healthy</span>
              <span x-show="!service.healthy && service.healthy !== undefined"
                >Error</span
              >
              <span x-show="service.healthy === undefined">Unknown</span>
            </span>
          </div>
        </div>
      </template>
    </template>
  </div>

  <!-- Loading State -->
  <div x-show="!systemHealth" class="flex items-center justify-center py-6">
    <div class="text-center">
      <div class="loading-spinner mx-auto mb-2"></div>
      <p class="text-sm text-gray-500">Checking system health...</p>
    </div>
  </div>

  <!-- System Summary with Null Safety -->
  <div
    x-show="systemHealth && systemHealth.summary"
    class="mt-4 pt-4 border-t border-gray-200"
  >
    <div class="grid grid-cols-2 gap-4 text-center">
      <div>
        <p
          class="text-lg font-semibold text-green-600"
          x-text="(systemHealth && systemHealth.summary && systemHealth.summary.healthy_services) || '0'"
        ></p>
        <p class="text-xs text-gray-500">Healthy Services</p>
      </div>
      <div>
        <p
          class="text-lg font-semibold text-gray-900"
          x-text="(systemHealth && systemHealth.summary && systemHealth.summary.total_services) || '0'"
        ></p>
        <p class="text-xs text-gray-500">Total Services</p>
      </div>
    </div>
  </div>

  <!-- Recommendations with Enhanced Null Safety -->
  <div
    x-show="systemHealth && systemHealth.recommendations && Array.isArray(systemHealth.recommendations) && systemHealth.recommendations.length > 0"
    class="mt-4 p-3 bg-yellow-50 border-l-4 border-yellow-400 rounded-r-lg"
  >
    <h4 class="text-sm font-medium text-yellow-800 mb-1">Recommendations:</h4>
    <ul class="text-xs text-yellow-700 space-y-1">
      <template
        x-if="systemHealth && systemHealth.recommendations && Array.isArray(systemHealth.recommendations)"
      >
        <template x-for="rec in systemHealth.recommendations" :key="rec">
          <li class="flex items-start">
            <i class="fas fa-lightbulb text-yellow-500 mt-0.5 mr-2 text-xs"></i>
            <span x-text="rec || ''"></span>
          </li>
        </template>
      </template>
    </ul>
  </div>

  <!-- Last Updated with Better Error Handling -->
  <div class="mt-4 pt-3 border-t border-gray-200 text-center">
    <p class="text-xs text-gray-500">
      Last updated:
      <span
        x-text="systemHealth && systemHealth.timestamp ? new Date((systemHealth.timestamp * 1000) || Date.now()).toLocaleTimeString() : 'Never'"
      ></span>
    </p>
    <button
      @click="loadSystemHealth()"
      class="mt-2 text-xs text-blue-600 hover:text-blue-800 underline"
    >
      Refresh Status
    </button>
  </div>
</div>
