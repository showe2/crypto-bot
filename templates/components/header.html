<header
  class="fixed top-0 left-0 right-0 z-50 gradient-bg text-white shadow-lg"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      <!-- Left Section -->
      <div class="flex items-center space-x-4">
        <!-- Mobile Menu Button -->
        <button
          @click="toggleSidebar()"
          class="lg:hidden p-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition-colors"
        >
          <i class="fas fa-bars text-xl"></i>
        </button>

        <!-- Logo and Title -->
        <div class="flex items-center space-x-3">
          <div class="relative">
            <div
              class="w-8 h-8 sm:w-10 sm:h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center pulse-glow"
            >
              <i class="fas fa-robot text-lg sm:text-xl"></i>
            </div>
            <!-- System Status Indicator -->
            <div
              class="absolute -top-1 -right-1 w-3 h-3 rounded-full border-2 border-white"
              :class="{
                'status-healthy': systemHealth && systemHealth.overall_status,
                'status-unhealthy': systemHealth && !systemHealth.overall_status,
                'status-warning': !systemHealth
              }"
            ></div>
          </div>

          <div class="hidden sm:block">
            <h1 class="text-lg sm:text-xl font-bold">
              Solana Token Analysis AI
            </h1>
            <p class="text-blue-100 text-xs sm:text-sm">
              Advanced crypto intelligence platform
            </p>
          </div>
        </div>
      </div>

      <!-- Center Section - Quick Search (Hidden on mobile) -->
      <div class="hidden md:flex flex-1 max-w-md mx-8">
        <div class="relative w-full">
          <input
            type="text"
            x-model="quickSearchQuery"
            @input="quickSearch($event.target.value)"
            @keyup.enter="performQuickAnalysis()"
            placeholder="Enter token mint address for quick analysis..."
            class="w-full px-4 py-2 pl-10 bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg placeholder-blue-100 text-white focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50"
          />
          <i
            class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-blue-100"
          ></i>

          <!-- Quick action button -->
          <button
            x-show="isValidSolanaAddress(quickSearchQuery)"
            @click="performQuickAnalysis()"
            class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-20 hover:bg-opacity-30 text-white text-sm px-3 py-1 rounded"
          >
            Analyze
          </button>
        </div>
      </div>

      <!-- Right Section -->
      <div class="flex items-center space-x-2">
        <!-- System Status Display (Hidden on mobile) -->
        <div
          class="hidden lg:flex items-center space-x-2 px-3 py-1 bg-white bg-opacity-20 rounded-lg"
        >
          <div
            class="w-2 h-2 rounded-full"
            :class="{
              'status-healthy': systemHealth && systemHealth.overall_status,
              'status-unhealthy': systemHealth && !systemHealth.overall_status,
              'status-warning': !systemHealth
            }"
          ></div>
          <span class="text-sm font-medium">
            <span x-show="systemHealth && systemHealth.overall_status"
              >System Online</span
            >
            <span x-show="systemHealth && !systemHealth.overall_status"
              >System Issues</span
            >
            <span x-show="!systemHealth">Checking...</span>
          </span>
        </div>

        <!-- Refresh Button -->
        <button
          @click="refreshData()"
          :disabled="isRefreshing"
          class="p-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition-colors disabled:opacity-50"
          title="Refresh system data"
        >
          <i
            class="fas fa-sync-alt text-sm sm:text-base"
            :class="{ 'animate-spin': isRefreshing }"
          ></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Search Bar -->
  <div class="md:hidden px-4 pb-3">
    <div class="relative">
      <input
        type="text"
        x-model="mobileSearchQuery"
        @keyup.enter="performMobileAnalysis()"
        placeholder="Enter token mint for analysis..."
        class="w-full px-4 py-2 pl-10 pr-16 bg-white bg-opacity-20 border border-white border-opacity-30 rounded-lg placeholder-blue-100 text-white focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50 text-sm"
      />
      <i
        class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-blue-100"
      ></i>
      <button
        x-show="isValidSolanaAddress(mobileSearchQuery)"
        @click="performMobileAnalysis()"
        class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-20 hover:bg-opacity-30 text-white text-xs px-2 py-1 rounded"
      >
        Go
      </button>
    </div>
  </div>
</header>

<script>
  // Add to global Alpine data
  document.addEventListener("alpine:init", () => {
    Alpine.data("headerData", () => ({
      quickSearchQuery: "",
      mobileSearchQuery: "",
      isRefreshing: false,

      async refreshData() {
        this.isRefreshing = true;

        try {
          await Promise.all([this.loadSystemHealth(), this.loadRealMetrics()]);

          this.showNotification("success", "Refreshed", "System data updated");
        } catch (error) {
          this.showNotification(
            "error",
            "Refresh Failed",
            "Could not update data"
          );
        } finally {
          this.isRefreshing = false;
        }
      },

      async performQuickAnalysis() {
        if (!this.isValidSolanaAddress(this.quickSearchQuery)) {
          this.showNotification(
            "error",
            "Invalid Address",
            "Please enter a valid Solana token mint address"
          );
          return;
        }

        window.location.href = `/analysis?token=${this.quickSearchQuery}`;
      },

      async performMobileAnalysis() {
        if (!this.isValidSolanaAddress(this.mobileSearchQuery)) {
          this.showNotification(
            "error",
            "Invalid Address",
            "Please enter a valid Solana token mint address"
          );
          return;
        }

        window.location.href = `/analysis?token=${this.mobileSearchQuery}`;
      },

      quickSearch(query) {
        // Simple validation feedback
        if (query && query.length >= 32 && this.isValidSolanaAddress(query)) {
          // Valid address format
          return true;
        }
        return false;
      },
    }));
  });
</script>
